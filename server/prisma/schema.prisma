generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ChatRole {
	OWNER
	ADMIN
	MEMBER
}

enum ChatType {
	PRIVATE
	GROUP
}

model User {
	id	String	@id @default(cuid())
	username	String	@unique
	email	String	@unique
	password	String
	avatarUrl	String?	@default("https://example.com/default-avatar.png")

	chatMembers ChatMember[]
	messages Message[]
	files File[]

	createdAt	DateTime	@default(now())
	updatedAt	DateTime	@updatedAt

	@@map("users")
}

model Chat {
	id	String	@id	@default(cuid())
	name	String?
	avatarUrl	String?

	type	ChatType

	members ChatMember[]
	messages Message[]

	createdAt	DateTime	@default(now())
	updatedAt	DateTime	@updatedAt

	@@map("chats")
}

model ChatMember {
	id	String	@id	@default(cuid())
	role ChatRole

	chatId	String
	chat	Chat	@relation(fields: [chatId], references: [id], onDelete: Cascade)

	userId	String
	user	User	@relation(fields: [userId], references: [id])

	@@map("chat-members")
}

model Message{
	id	String	@id	@default(cuid())
	content	String
	
	
	senderId	String
	sender	User	@relation(fields: [senderId], references: [id])

	chatId	String
	chat	Chat	@relation(fields: [chatId], references: [id])

	replyToMessageId	String?
	replyToMessage	Message?	@relation("ReplyTo", fields: [replyToMessageId], references: [id])

	replies	Message[]	@relation("ReplyTo")

	createdAt DateTime	@default(now())
	updatedAt DateTime	@updatedAt

	@@map("messages")
	
}

model File {
	id	String	@id	@default(cuid())
	name	String
	key	String
	size	Int
	mimeType	String
	url	String

	userId	String
	user	User	@relation(fields: [userId], references: [id])
	
	createdAt DateTime	@default(now())
}
