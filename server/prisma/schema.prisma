generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
	id	String	@id @default(cuid())
	username	String	@unique
	email	String	@unique
	password	String
	avatarUrl	String?	@default("https://example.com/default-avatar.png")

	members ChatMember[]
	messages Message[]
	files	File[]

	createdAt	DateTime	@default(now())
	updatedAt	DateTime	@updatedAt

	@@map("users")
}

enum FileStatus {
	TEMP
	PERMANENT
}

model File {
	id	String	@id	@default(cuid())
	name	String
	key	String
	size	Int
	mimeType	String
	url	String

	userId	String
	user	User	@relation(fields: [userId], references: [id])

	status	FileStatus @default(TEMP)
	
	createdAt DateTime	@default(now())
}

enum ChatType {
	PRIVATE
	GROUP
	CHANNEL
	SERVER_CHAT
	SERVER_VOICE
}

enum ChatRole {
	USER
	ADMIN
	MODERATOR
}

model ChatMember {
	id	String	@id	@default(cuid())
	role ChatRole

	chatId	String
	chat	Chat	@relation(fields: [chatId], references: [id])

	userId	String
	user	User	@relation(fields: [userId], references: [id])

	@@map("chat-members")
}

model Message{
	id	String	@id	@default(cuid())
	
	senderId	String
	sender	User	@relation(fields: [senderId], references: [id])

	chatId	String
	chat	Chat	@relation(fields: [chatId], references: [id])

	@@map("messages")
}

model Chat {
	id	String	@id	@default(cuid())
	type ChatType
	name	String?

	// serverId	String?
	// server	Server?	@relation(fields: [serverId], references: [id])

	messages Message[]
	members ChatMember[]

	@@map("chats")
}

// model Server{
// 	id	String	@id	@default(cuid())
// 	name	String

// 	chats	Chat[]

// 	@@map("servers")
// }
